# Buyma Insider

## TO-IMPLEMENTS
-

## TODO
- Migrate old rethinkdb data
- Add merchant index gateway that will scrape index pages
- Add indexer persistent models

## SETUP

- Unicorn in development can be run with local launch command
- Nginx has to be setup in production, but locally
  unicorn is directly listening on port 5000 and
  localhost, so nginx don't have to be setup
- - Nginx can be installed with --with-debug (dev, staging)
- - Nginx must be installed with --with-gzip-static
- - Using homebrew `brew tap homebrew/nginx`
- Daemonize command option is not added for unicorn, but
  could be if needed, just modify Procfile
- Make sure to set the ENVIRONMENT variable when running elsewhere
- Make sure that a proper HTTPS certificate is installed (https://gist.github.com/fnichol/867550)
- `foreman export launchd ./tmp/plist --log /usr/local/var/log`

### Docker / VirtualBox
- vboxmanage controlvm default natpf1 rethinkdb,tcp,127.0.0.1,8080,,8080

### Elasticsearch

- Setup indices
- Setup mappings
- Setup analyzers
```

### Docker
- rethinkdb

docker run --name rethinkdb -p 8080:8080 -p 28015:28015 --rm greyarch/rethinkdb

- elasticsearch

docker run --name elastic -p 9200:9200 -p 9300:9300 --rm -e ES_JAVA_OPTS='-Xms1g -Xmx1g' elasticsearch:latest

### Local
- unicorn

ENVIRONMENT=development be unicorn -c config/unicorn.rb -E $ENVIRONMENT -d --host localhost --port 5000

- pry

be pry -Iapp -rbuyma_insider

## NOTE

- Use be ruby to run patches instead of pry, pry screws up sometimes the format

## REST API endpoint used by frontend

/exchange_rates/latest
/crawl_sessions

### To Add New Merchants

- Add to merchants.yml
- Add merchant class to models/merchants
- Write a test
